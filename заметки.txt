Ğ¢Ñ‹ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¿Ñ€Ğ¸Ğ²ĞµÑÑ‚Ğ¸ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ´ Ğº Ğ±Ğ¾Ğ»ĞµĞµ Ñ‡Ğ¸ÑÑ‚Ğ¾Ğ¹ Ğ¸ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ. ĞĞ¸Ğ¶Ğµ Ñ Ğ¿Ğ¾ĞºĞ°Ğ¶Ñƒ:

ĞšĞ°ĞºĞ¾Ğ¹ Ñƒ Ñ‚ĞµĞ±Ñ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ñ€Ğ´Ğ°Ğº (Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ĞºĞ¾Ğ´Ğ°)

ĞšĞ°Ğº Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼

ĞšĞ°Ğº Ğ²Ñ‹Ğ³Ğ»ÑĞ´Ğ¸Ñ‚ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

Ğ§Ñ‚Ğ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞ°Ñ‚ÑŒ (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€)

ĞšĞ°Ğº Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ñ‹Ğ³Ğ»ÑĞ´ĞµÑ‚ÑŒ main.py (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ»)

Ğ§Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ğ´Ğ°Ğ»ÑŒÑˆĞµ

ğŸ“Œ Ğ¦ĞµĞ»ÑŒ: Ğ¾Ñ‚Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹, Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ², LLM-Ğ°Ğ´Ğ°Ğ¿Ñ‚ĞµÑ€ Ğ¸ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¾Ñ‚ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ main.py

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ” Ğ§Ñ‚Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ½Ğµ Ñ‚Ğ°Ğº:

Ğ’ÑÑ‘ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ñ„Ğ°Ğ¹Ğ»Ğµ: Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ¸, LLM-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹, Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹, Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ, Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ñ…Ğ¾Ğ´Ğ¾Ğ².

ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµÑ‚ÑÑ ĞºĞ¾Ğ´ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ NPC_PROMPT.

ĞŸÑ€ÑĞ¼Ğ°Ñ Ğ²ÑÑ‚Ğ°Ğ²ĞºĞ° JSON-Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ğ² f-ÑÑ‚Ñ€Ğ¾ĞºĞ¸.

ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹ Ñ€ÑƒĞºĞ°Ğ¼Ğ¸ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ¸ Ğ½Ğµ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.

ĞĞµÑ‚ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ¸Ñ Â«Ğ¸Ğ³Ñ€Ğ¾ĞºÂ», Â«Ğ°Ğ³ĞµĞ½Ñ‚Â», Â«Ğ³ĞµĞ¹Ğ¼Ğ¼Ğ°ÑÑ‚ĞµÑ€Â», ĞºĞ°Ğº ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ĞµĞ¹/ĞºĞ»Ğ°ÑÑĞ¾Ğ².

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… Ğ§Ñ‚Ğ¾ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ (Ğ¿Ğ¾ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ):

ĞœĞ¾Ğ´ÑƒĞ»Ğ¸:

src/
â”œâ”€â”€ agents/
â”‚ â””â”€â”€ base_agent.py â† Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Agent
â”‚ â””â”€â”€ npc_agent.py â† NPC-Ğ°Ğ³ĞµĞ½Ñ‚
â”‚ â””â”€â”€ player_agent.py â† Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
â”œâ”€â”€ characters/
â”‚ â””â”€â”€ character.py â† ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°
â”œâ”€â”€ llm/
â”‚ â””â”€â”€ g4f_adapter.py
â”‚ â””â”€â”€ prompts.py â† ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ²
â”œâ”€â”€ game/
â”‚ â””â”€â”€ history.py â† Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
â”‚ â””â”€â”€ turn_loop.py â† ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ¸Ğ³Ñ€Ñ‹
â”œâ”€â”€ main.py

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“¦ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ»Ğ°ÑÑÑ‹:

Character â€“ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°

Agent â€“ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ (NPC Ğ¸Ğ»Ğ¸ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº)

LLMAdapter â€“ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ OpenAI / g4f / LM Studio

PromptBuilder â€“ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°/Ğ³Ğ¼

GameHistory â€“ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“˜ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ refactorâ€™Ğ° Ñ‚Ğ²Ğ¾ĞµĞ³Ğ¾ ĞºĞ¾Ğ´Ğ°:

ğŸ”¸ character.py

from dataclasses import dataclass

@dataclass
class Character:
name: str
hp: int
stats: dict
char_class: str
controller: str
level: int
xp: int

ğŸ”¸ agents/base_agent.py

class Agent:
def init(self, character, llm_client):
self.character = character
self.llm = llm_client

def decide(self, game_history: list[str]) -> str:
    raise NotImplementedError


ğŸ”¸ agents/npc_agent.py

from src.llm.prompts import build_npc_prompt
from src.agents.base_agent import Agent

class NPCAgent(Agent):
def decide(self, game_history):
prompt = build_npc_prompt(self.character, game_history)
response = self.llm.user_prompt_chat(user_prompt=prompt)
return response

ğŸ”¸ agents/player_agent.py

class PlayerAgent(Agent):
def decide(self, game_history):
print("Ğ˜Ğ³Ñ€Ğ¾ĞºÑƒ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚ÑŒ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ.")
return input(">>> ")

ğŸ”¸ llm/prompts.py

def build_npc_prompt(character, history):
stats = character.stats
return f"""
Ğ¢Ñ‹ â€” AI-Ğ°Ğ³ĞµĞ½Ñ‚, ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‰Ğ¸Ğ¹ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¼ Ğ¸Ğ· Ğ¸Ğ³Ñ€Ñ‹ Ğ² ÑÑ‚Ğ¸Ğ»Ğµ DND.

Ğ˜Ğ¼Ñ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°: {character.name}
ĞšĞ»Ğ°ÑÑ: {character.char_class}
Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: {character.level}
Ğ¥ĞŸ: {character.hp}
Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸: Ğ¡Ğ¸Ğ»Ğ°={stats['str']}, Ğ›Ğ¾Ğ²ĞºĞ¾ÑÑ‚ÑŒ={stats['dex']}, Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚={stats['int']}, ...

Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ:
{history}

ĞĞ¿Ğ¸ÑˆĞ¸, Ñ‡Ñ‚Ğ¾ Ñ‚Ñ‹ Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑˆÑŒ Ğ¸ ĞºĞ°ĞºĞ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑˆÑŒ. ĞĞ´Ğ¸Ğ½ Ğ°Ğ±Ğ·Ğ°Ñ†, Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾.
"""

def build_gm_prompt(history):
return f"""Ğ¢Ñ‹ â€” Ğ³ĞµĞ¹Ğ¼Ğ¼Ğ°ÑÑ‚ĞµÑ€...
{history}
...Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ ÑÑ†ĞµĞ½Ñƒ."""

ğŸ”¸ game/history.py

class GameHistory:
def init(self):
self.events = []

def add(self, role: str, content: str):
    self.events.append({"role": role, "content": content})

def __str__(self):
    return "\n".join([f"{e['role']}: {e['content']}" for e in self.events])


ğŸ”¸ game/turn_loop.py

def run_turn(agents: list, gm_agent, history):
for agent in agents:
response = agent.decide(str(history))
print(f"{agent.character.name}: {response}")
history.add(agent.character.name, response)

gm_response = gm_agent.decide(str(history))
print(f"Ğ“Ğœ: {gm_response}")
history.add("GM", gm_response)


ğŸ”¸ main.py

from src.characters.character import Character
from src.llm.g4f_adapter import G4fClient
from src.agents.npc_agent import NPCAgent
from src.agents.player_agent import PlayerAgent
from src.game.history import GameHistory
from src.agents.npc_agent import NPCAgent

client = G4fClient()
history = GameHistory()

Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹

artem = Character(name="ĞÑ€Ñ‚ĞµĞ¼", hp=12, stats=..., char_class="Ğ’Ğ¾Ğ¸Ğ½", controller="player", level=1, xp=0)
azerty = Character(name="ĞĞ·ĞµÑ€Ñ‚Ğ¸", hp=8, stats=..., char_class="Ğ”Ñ€ÑƒĞ¸Ğ´", controller="npc", level=1, xp=0)

ĞĞ³ĞµĞ½Ñ‚Ñ‹

artem_agent = PlayerAgent(artem, client)
azerty_agent = NPCAgent(azerty, client)
gm_agent = NPCAgent(Character(name="GM", hp=0, stats={}, char_class="", controller="gm", level=0, xp=0), client)

ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ»

from src.game.turn_loop import run_turn

for _ in range(5):
run_turn([artem_agent, azerty_agent], gm_agent, history)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ§¼ ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:

Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² (LLM, Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº, ÑĞºÑ€Ğ¸Ğ¿Ñ‚)

ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹ Ğ±ĞµĞ· ĞºĞ¾Ğ¿Ğ¸Ğ¿Ğ°ÑÑ‚Ñ‹

Ğ£Ğ´Ğ¾Ğ±Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ, RAG, Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸ Ñ‚.Ğ¿.

ĞœĞ¾Ğ¶Ğ½Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“¦ Ğ¥Ğ¾Ñ‡ĞµÑˆÑŒ:

scaffold Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ñ Ñ‚Ğ°ĞºĞ¸Ğ¼Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸?

Ğ¸Ğ»Ğ¸ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ NPC Ğ°Ğ³ĞµĞ½Ñ‚Ğ° Ğ¸ PromptBuilder?

ĞœĞ¾Ğ³Ñƒ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ Ğ² Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ… â€” ÑĞºĞ°Ğ¶Ğ¸, ĞºĞ°Ğº ÑƒĞ´Ğ¾Ğ±Ğ½ĞµĞµ.